# This is a travis-ci.org continuous integration configuration file.
language: node_js
node_js:
  - 12

cache:
  npm: true
  directories:
  - travis_cache

import:
  - credentials.yml

jobs:
  include:
    - stage: Testing
      name: travis-freecad-checking

      before_script:
        - sudo add-apt-repository -y ppa:freecad-maintainers/freecad-stable
        - sudo apt-get update
        - sudo apt-get install -y freecad freecad-python3
        - sudo mkdir /usr/lib/freecad-python3/Mod

      script:
        # use case
        - mkdir -p .travis
        - wget https://raw.githubusercontent.com/louiscklaw/travis-playlist/master/travis-freecad-checking/freecad_open_test.py -O .travis/freecad_open_test.py
        - for i in $(find . -name '*.FCStd'); do python3 .travis/freecad_open_test.py $i; done

    - stage: Testing
      name: origional-voron-testing
      before_install:
        - chmod +x ./travis_scripts/ci-build.sh
        - npm install remark-cli remark-validate-links

      script: ./travis_scripts/ci-build.sh


    - stage: Merging
      name: merge-to-master
      script:
        - wget https://raw.githubusercontent.com/louiscklaw/travis-playlist/master/travis-build-merger/merge_if_success.sh
        - bash merge_if_success.sh | tee merge.log
